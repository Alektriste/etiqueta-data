<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f0c29">
    <title>Validade Pro - Sistema Completo</title>
    
    <style>        .dono-tab.active {
            color: var(--warning);
            background: rgba(250, 204, 21, 0.15);
        }
        
        optgroup {
            color: #fff;
            background: rgba(0,0,0,0.3);
        }
        
        optgroup option {
            color: #fff;
            background: #302b63;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #00d2ff;
            --secondary: #3a7bd5;
            --success: #38ef7d;
            --danger: #ff6b6b;
            --warning: #facc15;
            --print: #ff6b9d;
            --bg-dark: #0f0c29;
            --bg-mid: #302b63;
            --bg-light: #24243e;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, var(--bg-dark) 0%, var(--bg-mid) 50%, var(--bg-light) 100%);
            color: #fff;
        }

        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .app-header {
            height: 70px;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }

        .header-title {
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-subtitle {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.6);
        }

        /* Content */
        .app-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* Bottom Nav */
        .bottom-nav {
            height: 80px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-shrink: 0;
            padding-bottom: env(safe-area-inset-bottom, 0);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            color: rgba(255,255,255,0.6);
            font-size: 0.7rem;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 16px;
            transition: all 0.3s;
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(0,210,255,0.15);
        }

        .nav-item.print-tab.active {
            color: var(--print);
            background: rgba(255,107,157,0.15);
        }

        .nav-item.admin-tab.active {
            color: var(--warning);
            background: rgba(250,204,21,0.15);
        }

        .nav-icon {
            font-size: 1.6rem;
        }

        /* Views */
        .view {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card-title.print {
            color: var(--print);
        }

        .card-title.admin {
            color: var(--warning);
        }

        /* Inputs */
        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .input-group input, .input-group select {
            width: 100%;
            height: 56px;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 0 20px;
            font-size: 1rem;
            color: #fff;
            outline: none;
            transition: all 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            border-color: var(--primary);
        }

        /* Search */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            height: 60px;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 0 20px 0 56px;
            font-size: 1.1rem;
            color: #fff;
            outline: none;
        }

        .search-input:focus {
            border-color: var(--primary);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.3rem;
            opacity: 0.5;
        }

        .suggestions {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: rgba(30,30,50,0.98);
            border-radius: 16px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 18px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .suggestion-item:hover {
            background: rgba(0,210,255,0.1);
        }

        /* Buttons */
        .btn {
            width: 100%;
            height: 56px;
            border: none;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s;
            margin-bottom: 12px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #11998e);
            color: #fff;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ee5a6f);
            color: #fff;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #eab308);
            color: #000;
        }

        .btn-print {
            background: linear-gradient(135deg, var(--print), #e91e63);
            color: #fff;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* Preview */
        .preview-panel {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 24px;
            margin-top: 20px;
            display: none;
            border: 2px solid var(--print);
        }

        .preview-panel.active {
            display: block;
        }

        .label-preview {
            background: #fff;
            border-radius: 12px;
            padding: 30px 20px;
            margin: 0 auto 24px;
            max-width: 340px;
            text-align: center;
            color: #000;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .label-header {
            position: absolute;
            top: 15px;
            font-size: 0.7rem;
            font-weight: 800;
            letter-spacing: 3px;
            color: #666;
        }

        .label-product {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .label-date {
            font-size: 2.2rem;
            font-weight: 800;
        }

        .label-time {
            font-size: 1.1rem;
            color: #333;
            margin-top: 5px;
        }

        .label-amb {
            position: absolute;
            bottom: 45px;
            font-size: 0.75rem;
            color: #d00;
            font-weight: 700;
        }

        .label-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 32px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            color: #666;
            border-top: 1px solid #ddd;
        }

        /* Categories */
        .category-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .category-card {
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            overflow: hidden;
            border-left: 4px solid;
        }

        .cat-vegetais { border-color: #4ade80; }
        .cat-embalagens { border-color: #22c55e; }
        .cat-molhos { border-color: #facc15; }
        .cat-molhos-emb { border-color: #eab308; }
        .cat-bacons { border-color: #f87171; }
        .cat-bacon-emb { border-color: #ef4444; }
        .cat-sobremesas-liq { border-color: #e879f9; }
        .cat-sobremesas-liq-emb { border-color: #d946ef; }
        .cat-sobremesas-secas { border-color: #c084fc; }
        .cat-sobremesas-secas-emb { border-color: #a855f7; }

        .category-header {
            padding: 18px 20px;
            font-weight: 700;
            font-size: 0.95rem;
            text-transform: uppercase;
            background: rgba(0,0,0,0.2);
        }

        .cat-vegetais .category-header { color: #4ade80; }
        .cat-embalagens .category-header { color: #22c55e; }
        .cat-molhos .category-header { color: #facc15; }
        .cat-molhos-emb .category-header { color: #eab308; }
        .cat-bacons .category-header { color: #f87171; }
        .cat-bacon-emb .category-header { color: #ef4444; }
        .cat-sobremesas-liq .category-header { color: #e879f9; }
        .cat-sobremesas-liq-emb .category-header { color: #d946ef; }
        .cat-sobremesas-secas .category-header { color: #c084fc; }
        .cat-sobremesas-secas-emb .category-header { color: #a855f7; }

        .category-items {
            padding: 8px;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .category-item:hover {
            background: rgba(255,255,255,0.05);
        }

        .item-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .item-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .item-meta {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.5);
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: rgba(0,210,255,0.1);
            border: 1px solid rgba(0,210,255,0.3);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            background: rgba(0,210,255,0.2);
        }

        .btn-icon.print {
            background: rgba(255,107,157,0.1);
            border-color: rgba(255,107,157,0.3);
            color: var(--print);
        }

        .btn-icon.print:hover {
            background: rgba(255,107,157,0.2);
        }

        .btn-icon.delete {
            background: rgba(255,107,107,0.1);
            border-color: rgba(255,107,107,0.3);
            color: var(--danger);
        }

        .btn-icon.delete:hover {
            background: rgba(255,107,107,0.2);
        }

        /* Admin */
        .admin-item {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-item-info {
            flex: 1;
        }

        .admin-item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .admin-item-cat {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.5);
        }

        .admin-item-hours {
            font-size: 0.9rem;
            color: var(--primary);
            margin-right: 12px;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 90px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(56,239,125,0.95);
            color: #000;
            padding: 16px 28px;
            border-radius: 16px;
            font-weight: 700;
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: rgba(255,107,107,0.95);
            color: #fff;
        }

        /* History */
        .history-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 16px;
        }

        .history-chip {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            padding: 12px 18px;
            border-radius: 24px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .history-chip:hover {
            background: var(--primary);
            color: #000;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255,255,255,0.5);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .app-content {
                max-width: 600px;
                margin: 0 auto;
            }
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .label-preview, .label-preview * {
                visibility: visible;
            }
            .label-preview {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
            }
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: rgba(255,255,255,0.5);
        }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div>
                <div class="header-title">üìã Validade Pro</div>
                <div class="header-subtitle" id="headerSubtitle">Carregando...</div>
            </div>
        </header>

        <!-- Content -->
        <main class="app-content">
            
            <!-- VIEW: Consulta -->
                            <!-- Card de Hor√°rio Manual -->
                <div class="card">
                    <div class="card-title">‚è∞ Hor√°rio de In√≠cio</div>
                    <div class="input-group">
                        <label>Definir hor√°rio manualmente (opcional)</label>
                        <input type="datetime-local" id="horarioManual" onchange="atualizarHorarioManual()">
                    </div>
                    <div style="font-size: 0.85rem; color: rgba(255,255,255,0.6); margin-top: 8px;">
                        üí° Deixe vazio para usar hor√°rio atual: <span id="horarioAtual"></span>
                    </div>
                    <button class="btn btn-secondary" onclick="usarHorarioAtual()" style="margin-top: 12px;">
                        üîÑ Usar Hor√°rio Atual
                    </button>
                </div>
                
            <div id="viewConsulta" class="view active">
                <div class="card">
                    <div class="card-title">üîç Buscar Produto</div>
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" id="searchConsulta" placeholder="Digite o nome do produto..." autocomplete="off">
                        <div class="suggestions" id="suggestionsConsulta"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üì¶ Todos os Produtos</div>
                    <div class="category-list" id="categoryList">
                        <div class="loading">Carregando produtos</div>
                    </div>
                </div>
            </div>

            <!-- VIEW: Impress√£o -->
            <div id="viewImpressao" class="view">
                <div class="card">
                    <div class="card-title print">üñ®Ô∏è Impress√£o de Etiquetas</div>
                    
                    <div class="search-box">
                        <span class="search-icon">üñ®Ô∏è</span>
                        <input type="text" class="search-input" id="searchPrint" placeholder="Digite para imprimir..." autocomplete="off">
                        <div class="suggestions" id="suggestionsPrint"></div>
                    </div>

                    <div class="history-chips" id="historyChips"></div>
                </div>

                <div class="preview-panel" id="previewPanel">
                    <div class="label-preview" id="labelPreview">
                        <div class="label-header">VALIDADE</div>
                        <div class="label-product" id="previewProduct">-</div>
                        <div class="label-date" id="previewDate">--/--</div>
                        <div class="label-time" id="previewTime">--:--</div>
                        <div class="label-amb" id="previewAmb"></div>
                        <div class="label-footer" id="previewFooter">--</div>
                    </div>

                    <button class="btn btn-print" onclick="imprimirEtiqueta()">
                        üñ®Ô∏è IMPRIMIR AGORA
                    </button>
                    <button class="btn btn-secondary" onclick="fecharPreview()">
                        ‚úï Cancelar
                    </button>
                </div>
            </div>

                        <!-- VIEW: Admin -->
            <div id="viewAdmin" class="view">
                <div class="card">
                    <div class="card-title admin">‚ûï Adicionar Produto</div>
                    
                    <div class="input-group">
                        <label>Categoria</label>
                        <select id="newCategoria">
                            <option value="Vegetais">Vegetais</option>
                            <option value="Embalagens de Vegetal">Embalagens de Vegetal</option>
                            <option value="Molhos">Molhos</option>
                            <option value="Molhos Embalagem">Molhos Embalagem</option>
                            <option value="Bacons">Bacons</option>
                            <option value="Bacon Embalagens">Bacon Embalagens</option>
                            <option value="Sobremesas L√≠quidas">Sobremesas L√≠quidas</option>
                            <option value="Sobremesas L√≠quidas Embalagens">Sobremesas L√≠quidas Embalagens</option>
                            <option value="Sobremesas Secas">Sobremesas Secas</option>
                            <option value="Sobremesas Secas Embalagem">Sobremesas Secas Embalagem</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Nome do Produto</label>
                        <input type="text" id="newNome" placeholder="Ex: Produto Novo">
                    </div>

                    <div class="input-group">
                        <label>Validade (horas)</label>
                        <input type="number" id="newHoras" placeholder="Ex: 24" min="1">
                    </div>

                    <div class="input-group">
                        <label>Ambienta√ß√£o (horas, opcional)</label>
                        <input type="number" id="newAmb" placeholder="0 = sem ambienta√ß√£o" min="0">
                    </div>

                    <button class="btn btn-success" onclick="adicionarProduto()">
                        ‚ûï Adicionar Produto
                    </button>
                </div>

                <div class="card">
                    <div class="card-title admin">üóëÔ∏è Gerenciar Produtos</div>
                    <div id="adminList"></div>
                </div>
            </div>

            <!-- VIEW: Dono (Protegida por senha) -->
            <div id="viewDono" class="view">
                <!-- Tela de Login -->
                <div id="loginPanel" class="card">
                    <div class="card-title admin">üîê Acesso do Dono</div>
                    <div class="input-group">
                        <label>Usu√°rio</label>
                        <input type="text" id="loginUser" placeholder="Digite o usu√°rio">
                    </div>
                    <div class="input-group">
                        <label>Senha</label>
                        <input type="password" id="loginPass" placeholder="Digite a senha">
                    </div>
                    <button class="btn btn-primary" onclick="fazerLogin()">
                        üîì Entrar
                    </button>
                    <div id="loginErro" style="color: #ff6b6b; margin-top: 10px; display: none;">
                        ‚ùå Usu√°rio ou senha incorretos!
                    </div>
                </div>

                <!-- Painel Admin (escondido at√© logar) -->
                <div id="painelAdmin" style="display: none;">
                    <div class="card">
                        <div class="card-title admin">‚ûï Adicionar Produto</div>
                        <div class="input-group">
                            <label>Categoria</label>
                            <select id="donoCategoria">
                                <option value="Vegetais">Vegetais</option>
                                <option value="Embalagens de Vegetal">Embalagens de Vegetal</option>
                                <option value="Molhos">Molhos</option>
                                <option value="Molhos Embalagem">Molhos Embalagem</option>
                                <option value="Bacons">Bacons</option>
                                <option value="Bacon Embalagens">Bacon Embalagens</option>
                                <option value="Sobremesas L√≠quidas">Sobremesas L√≠quidas</option>
                                <option value="Sobremesas L√≠quidas Embalagens">Sobremesas L√≠quidas Embalagens</option>
                                <option value="Sobremesas Secas">Sobremesas Secas</option>
                                <option value="Sobremesas Secas Embalagem">Sobremesas Secas Embalagem</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Nome do Produto</label>
                            <input type="text" id="donoNome" placeholder="Ex: Produto Novo">
                        </div>
                        <div class="input-group">
                            <label>Validade (horas)</label>
                            <input type="number" id="donoHoras" placeholder="Ex: 24" min="1">
                        </div>
                        <div class="input-group">
                            <label>Ambienta√ß√£o (horas, opcional)</label>
                            <input type="number" id="donoAmb" placeholder="0 = sem ambienta√ß√£o" min="0">
                        </div>
                        <button class="btn btn-success" onclick="donoAdicionar()">
                            ‚ûï Adicionar Produto
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-title admin">‚úèÔ∏è Modificar Produto Existente</div>
                        <div class="input-group">
                            <label>Selecionar Produto</label>
                            <select id="donoSelectProduto" onchange="donoCarregarProduto()">
                                <option value="">-- Escolha um produto --</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Nova Validade (horas)</label>
                            <input type="number" id="donoEditHoras" placeholder="Nova validade" min="1">
                        </div>
                        <div class="input-group">
                            <label>Nova Ambienta√ß√£o (horas)</label>
                            <input type="number" id="donoEditAmb" placeholder="Nova ambienta√ß√£o" min="0">
                        </div>
                        <button class="btn btn-warning" onclick="donoSalvarEdicao()">
                            üíæ Salvar Altera√ß√µes
                        </button>
                        <button class="btn btn-danger" onclick="donoExcluir()">
                            üóëÔ∏è Excluir Produto
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-title admin">üóëÔ∏è Gerenciar Todos</div>
                        <div id="donoListaProdutos"></div>
                    </div>

                    <button class="btn btn-secondary" onclick="donoSair()">
                        üö™ Sair do Modo Dono
                    </button>
                </div>
            </div>
            
        </main>

        <!-- Bottom Nav -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="showView('consulta')">
                <span class="nav-icon">üîç</span>
                <span>Consulta</span>
            </button>
            <button class="nav-item print-tab" onclick="showView('impressao')">
                <span class="nav-icon">üñ®Ô∏è</span>
                <span>Imprimir</span>
            </button>
            <button class="nav-item admin-tab" onclick="showView('admin')">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span>Gerenciar</span>
            </button>
        </nav>
                    <button class="nav-item dono-tab" onclick="showView('dono')">
                <span class="nav-icon">üîê</span>
                <span>Dono</span>
            </button>
            
        <!-- Toast -->
        <div class="toast" id="toast"></div>
    </div>
        <script>
        // ==========================================
        // DADOS INICIAIS - TODOS OS PRODUTOS
        // ==========================================
        var dadosIniciais = {
            "Vegetais": {
                "Alface": { horas: 5, amb: 5 },
                "Tomate": { horas: 4, amb: 0 },
                "Cebola": { horas: 5, amb: 5 },
                "Picles": { horas: 8, amb: 0 },
                "Jalapenho": { horas: 8, amb: 0 },
                "Cebola crispy": { horas: 12, amb: 0 },
                "Queijo cheddar (Fatias)": { horas: 4, amb: 4 }
            },
            "Embalagens de Vegetal": {
                "Alface (Embalagem)": { horas: 24, amb: 0 },
                "Cebola (Embalagem)": { horas: 24, amb: 0 },
                "Cebola crispy (Embalagem)": { horas: 168, amb: 0 },
                "Jalapenho (Embalagem)": { horas: 240, amb: 0 },
                "Picles (Embalagem)": { horas: 168, amb: 0 }
            },
            "Molhos": {
                "Barbecue": { horas: 12, amb: 0 },
                "Cheddar (Molho)": { horas: 5, amb: 5 },
                "Furioso": { horas: 12, amb: 0 },
                "Ketchup": { horas: 12, amb: 0 },
                "Maionese": { horas: 12, amb: 0 },
                "Mostarda": { horas: 12, amb: 0 },
                "Molho stacker": { horas: 12, amb: 0 }
            },
            "Molhos Embalagem": {
                "Barbecue (Embalagem)": { horas: 168, amb: 0 },
                "Cheddar (Embalagem)": { horas: 120, amb: 0 },
                "Furioso (Embalagem)": { horas: 168, amb: 0 },
                "Ketchup (Embalagem)": { horas: 1440, amb: 0 },
                "Maionese (Embalagem)": { horas: 168, amb: 0 },
                "Mostarda (Embalagem)": { horas: 168, amb: 0 },
                "Molho stacker (Embalagem)": { horas: 72, amb: 0 }
            },
            "Bacons": {
                "Bacon pronto": { horas: 4, amb: 0 },
                "Bacon cubos/picados": { horas: 8, amb: 0 }
            },
            "Bacon Embalagens": {
                "Bacon pronto (Embalagem)": { horas: 720, amb: 0 },
                "Bacon picado (Embalagem)": { horas: 72, amb: 0 }
            },
            "Sobremesas L√≠quidas": {
                "Xarope de baunilha": { horas: 24, amb: 0 },
                "Calda de Chocolate": { horas: 168, amb: 0 },
                "Calda de doce de leite": { horas: 168, amb: 0 },
                "Calda de morango": { horas: 72, amb: 0 },
                "Calda de ovomaltine": { horas: 168, amb: 0 },
                "Nutella": { horas: 48, amb: 0 }
            },
            "Sobremesas L√≠quidas Embalagens": {
                "Xarope de baunilha (Emb.)": { horas: 168, amb: 0 },
                "Calda de chocolate (Emb.)": { horas: 240, amb: 0 },
                "Calda de doce de leite (Emb.)": { horas: 360, amb: 0 },
                "Calda de morango (Emb.)": { horas: 240, amb: 0 },
                "Calda de ovomaltine (Emb.)": { horas: 2880, amb: 0 },
                "Nutella (Emb.)": { horas: 720, amb: 0 }
            },
            "Sobremesas Secas": {
                "Casquinha": { horas: 24, amb: 0 },
                "Ovomaltine em p√≥": { horas: 168, amb: 0 },
                "Brownie picado": { horas: 72, amb: 0 },
                "Leite em p√≥": { horas: 168, amb: 0 },
                "Prote√≠na": { horas: 168, amb: 0 }
            },
            "Sobremesas Secas Embalagem": {
                "Ovomaltine em p√≥ (Emb.)": { horas: 720, amb: 0 },
                "Brownie picado (Emb.)": { horas: 720, amb: 0 },
                "Leite em p√≥ (Emb.)": { horas: 360, amb: 0 },
                "Prote√≠na (Emb.)": { horas: 720, amb: 0 }
            }
        };

        // ==========================================
        // VARIAVEIS GLOBAIS
        // ==========================================
        var produtos = {};
        var historico = [];
        var produtoAtual = null;
                // ==========================================
        // INICIALIZACAO
        // ==========================================
        function init() {
            // Copia dados iniciais para produtos
            for (var cat in dadosIniciais) {
                produtos[cat] = {};
                for (var item in dadosIniciais[cat]) {
                    produtos[cat][item] = {
                        horas: dadosIniciais[cat][item].horas,
                        amb: dadosIniciais[cat][item].amb
                    };
                }
            }
            
            // Tenta carregar do localStorage
            try {
                var salvos = localStorage.getItem('vp');
                if (salvos) {
                    var parsed = JSON.parse(salvos);
                    if (parsed && Object.keys(parsed).length > 0) {
                        produtos = parsed;
                    }
                }
            } catch (e) {
                console.log('Storage nao disponivel');
            }
            
            renderizarCategorias();
            setupEventos();
            atualizarHora();
            setInterval(atualizarHora, 1000);
        }

        function atualizarHora() {
            var agora = new Date();
            var el = document.getElementById('headerSubtitle');
            if (el) {
                el.textContent = agora.toLocaleDateString('pt-BR') + ' ' + 
                    agora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
            }
        }
                // ==========================================
        // RENDERIZACAO
        // ==========================================
        function renderizarCategorias(filtro) {
            var container = document.getElementById('categoryList');
            if (!container) return;
            
            container.innerHTML = '';
            
            var termo = (filtro || '').toLowerCase();
            var encontrou = false;
            
            for (var categoria in produtos) {
                var itens = produtos[categoria];
                var itensFiltrados = [];
                
                for (var nome in itens) {
                    if (!termo || nome.toLowerCase().indexOf(termo) !== -1) {
                        itensFiltrados.push({ nome: nome, dados: itens[nome] });
                    }
                }
                
                if (itensFiltrados.length === 0) continue;
                encontrou = true;
                
                var card = document.createElement('div');
                card.className = 'category-card ' + getClasseCategoria(categoria);
                
                var header = document.createElement('div');
                header.className = 'category-header';
                header.textContent = categoria;
                card.appendChild(header);
                
                var itemsDiv = document.createElement('div');
                itemsDiv.className = 'category-items';
                
                for (var i = 0; i < itensFiltrados.length; i++) {
                    var item = itensFiltrados[i];
                    var validade = calcularValidade(item.dados.horas);
                    var div = document.createElement('div');
                    div.className = 'category-item';
                    
                    var ambText = item.dados.amb > 0 ? ' ‚Ä¢ üå°Ô∏è Amb: ' + item.dados.amb + 'h' : '';
                    
                    div.innerHTML = 
                        '<div class="item-info">' +
                            '<div class="item-name">' + escapeHtml(item.nome) + '</div>' +
                            '<div class="item-meta">' +
                                '‚è±Ô∏è ' + item.dados.horas + 'h (' + Math.floor(item.dados.horas/24) + 'd) ‚Ä¢ ' +
                                'üìÖ ' + validade.data + ' ' + validade.hora + ' ‚Ä¢ ' +
                                validade.diaSemana + ambText +
                            '</div>' +
                        '</div>' +
                        '<div class="item-actions">' +
                            '<button class="btn-icon print" onclick="prepararImpressao(\'' + escapeHtml(item.nome) + '\', \'' + categoria + '\')" title="Imprimir">' +
                                'üñ®Ô∏è' +
                            '</button>' +
                        '</div>';
                    
                    itemsDiv.appendChild(div);
                }
                
                card.appendChild(itemsDiv);
                container.appendChild(card);
            }
            
            if (!encontrou) {
                container.innerHTML = 
                    '<div class="empty-state">' +
                        '<div class="empty-state-icon">üîç</div>' +
                        '<div>Nenhum produto encontrado</div>' +
                    '</div>';
            }
        }

        function getClasseCategoria(categoria) {
            var map = {
                'Vegetais': 'cat-vegetais',
                'Embalagens de Vegetal': 'cat-embalagens',
                'Molhos': 'cat-molhos',
                'Molhos Embalagem': 'cat-molhos-emb',
                'Bacons': 'cat-bacons',
                'Bacon Embalagens': 'cat-bacon-emb',
                'Sobremesas L√≠quidas': 'cat-sobremesas-liq',
                'Sobremesas L√≠quidas Embalagens': 'cat-sobremesas-liq-emb',
                'Sobremesas Secas': 'cat-sobremesas-secas',
                'Sobremesas Secas Embalagem': 'cat-sobremesas-secas-emb'
            };
            return map[categoria] || '';
        }

        function calcularValidade(horas) {
            var agora = new Date();
            var validade = new Date(agora.getTime() + (horas * 60 * 60 * 1000));
            
            var dias = ['Do', '2¬™', '3¬™', '4¬™', '5¬™', '6¬™', 'S√°'];
            
            return {
                data: ('0' + validade.getDate()).slice(-2) + '/' + ('0' + (validade.getMonth() + 1)).slice(-2),
                hora: ('0' + validade.getHours()).slice(-2) + ':' + ('0' + validade.getMinutes()).slice(-2),
                diaSemana: dias[validade.getDay()]
            };
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/'/g, "\\'");
        }
                // ==========================================
        // EVENTOS
        // ==========================================
        function setupEventos() {
            var searchConsulta = document.getElementById('searchConsulta');
            if (searchConsulta) {
                searchConsulta.addEventListener('input', function(e) {
                    renderizarCategorias(e.target.value);
                });
            }
            
            var searchPrint = document.getElementById('searchPrint');
            if (searchPrint) {
                searchPrint.addEventListener('input', function(e) {
                    mostrarSugestoesPrint(e.target.value);
                });
            }
        }

        function mostrarSugestoesPrint(termo) {
            var suggestionsPrint = document.getElementById('suggestionsPrint');
            if (!suggestionsPrint) return;
            
            termo = termo.toLowerCase();
            
            if (termo.length < 1) {
                suggestionsPrint.classList.remove('active');
                return;
            }
            
            var matches = [];
            for (var categoria in produtos) {
                for (var nome in produtos[categoria]) {
                    if (nome.toLowerCase().indexOf(termo) !== -1) {
                        matches.push({ nome: nome, categoria: categoria });
                    }
                }
            }
            
            if (matches.length > 0) {
                var html = '';
                for (var i = 0; i < matches.length; i++) {
                    var m = matches[i];
                    html += '<div class="suggestion-item" onclick="selecionarSugestaoPrint(\'' + escapeHtml(m.nome) + '\', \'' + m.categoria + '\')">' +
                        '<span>' + escapeHtml(m.nome) + '</span>' +
                        '<span style="color: rgba(255,255,255,0.5); font-size: 0.8rem;">' + m.categoria + '</span>' +
                    '</div>';
                }
                suggestionsPrint.innerHTML = html;
                suggestionsPrint.classList.add('active');
            } else {
                suggestionsPrint.classList.remove('active');
            }
        }

        function selecionarSugestaoPrint(nome, categoria) {
            var searchPrint = document.getElementById('searchPrint');
            var suggestionsPrint = document.getElementById('suggestionsPrint');
            if (searchPrint) searchPrint.value = nome;
            if (suggestionsPrint) suggestionsPrint.classList.remove('active');
            prepararImpressao(nome, categoria);
        }

        function showView(viewName) {
            var views = document.querySelectorAll('.view');
            for (var i = 0; i < views.length; i++) {
                views[i].classList.remove('active');
            }
            
            var navs = document.querySelectorAll('.nav-item');
            for (var i = 0; i < navs.length; i++) {
                navs[i].classList.remove('active');
            }
            
            var viewId = 'view' + viewName.charAt(0).toUpperCase() + viewName.slice(1);
            var view = document.getElementById(viewId);
            if (view) view.classList.add('active');
            
            var buttons = document.querySelectorAll('.nav-item');
            if (viewName === 'consulta' && buttons[0]) buttons[0].classList.add('active');
            if (viewName === 'impressao' && buttons[1]) buttons[1].classList.add('active');
            if (viewName === 'admin' && buttons[2]) buttons[2].classList.add('active');
            
            if (viewName === 'consulta') renderizarCategorias();
            if (viewName === 'admin') renderizarAdmin();
            if (viewName === 'impressao') renderizarHistorico();
        }
                // ==========================================
        // IMPRESSAO
        // ==========================================
        function prepararImpressao(nome, categoria) {
            if (!produtos[categoria] || !produtos[categoria][nome]) return;
            
            var dados = produtos[categoria][nome];
            produtoAtual = { nome: nome, categoria: categoria, horas: dados.horas, amb: dados.amb };
            
            var validade = calcularValidade(dados.horas);
            
            var elProd = document.getElementById('previewProduct');
            var elDate = document.getElementById('previewDate');
            var elTime = document.getElementById('previewTime');
            var elFooter = document.getElementById('previewFooter');
            var elAmb = document.getElementById('previewAmb');
            var elPanel = document.getElementById('previewPanel');
            
            if (elProd) elProd.textContent = nome;
            if (elDate) elDate.textContent = validade.data;
            if (elTime) elTime.textContent = validade.hora;
            if (elFooter) elFooter.textContent = 'Validade: ' + dados.horas + 'h';
            
            if (elAmb) {
                if (dados.amb > 0) {
                    elAmb.textContent = 'AMBIENTACAO: ' + dados.amb + 'H';
                    elAmb.style.display = 'block';
                } else {
                    elAmb.style.display = 'none';
                }
            }
            
            if (elPanel) elPanel.classList.add('active');
            
            adicionarHistorico(nome);
        }

        function fecharPreview() {
            var panel = document.getElementById('previewPanel');
            if (panel) panel.classList.remove('active');
            produtoAtual = null;
        }

        function imprimirEtiqueta() {
            if (!produtoAtual) return;
            window.print();
            showToast('üñ®Ô∏è Enviado para impressao!');
            setTimeout(fecharPreview, 500);
        }

        function adicionarHistorico(nome) {
            historico = historico.filter(function(h) { return h !== nome; });
            historico.unshift(nome);
            if (historico.length > 10) historico = historico.slice(0, 10);
            
            try {
                localStorage.setItem('vh', JSON.stringify(historico));
            } catch (e) {}
            
            renderizarHistorico();
        }

        function renderizarHistorico() {
            var container = document.getElementById('historyChips');
            if (!container) return;
            
            if (historico.length === 0) {
                container.innerHTML = '<div style="color: rgba(255,255,255,0.5); font-size: 0.9rem;">Nenhum historico ainda</div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < historico.length; i++) {
                var nome = historico[i];
                var cat = '';
                for (var c in produtos) {
                    if (produtos[c][nome]) {
                        cat = c;
                        break;
                    }
                }
                html += '<div class="history-chip" onclick="prepararImpressao(\'' + escapeHtml(nome) + '\', \'' + cat + '\')">üïê ' + escapeHtml(nome) + '</div>';
            }
            container.innerHTML = html;
        }
                // ==========================================
        // ADMIN
        // ==========================================
        function adicionarProduto() {
            var categoria = document.getElementById('newCategoria').value;
            var nome = document.getElementById('newNome').value.trim();
            var horas = parseInt(document.getElementById('newHoras').value);
            var amb = parseInt(document.getElementById('newAmb').value) || 0;
            
            if (!nome || !horas || horas < 1) {
                showToast('‚ùå Preencha todos os campos obrigatorios!', true);
                return;
            }
            
            if (!produtos[categoria]) {
                produtos[categoria] = {};
            }
            
            if (produtos[categoria][nome]) {
                showToast('‚ùå Produto ja existe!', true);
                return;
            }
            
            produtos[categoria][nome] = { horas: horas, amb: amb };
            
            try {
                localStorage.setItem('vp', JSON.stringify(produtos));
            } catch (e) {}
            
            document.getElementById('newNome').value = '';
            document.getElementById('newHoras').value = '';
            document.getElementById('newAmb').value = '';
            
            showToast('‚úÖ Produto adicionado com sucesso!');
            renderizarAdmin();
        }

        function removerProduto(categoria, nome) {
            if (!confirm('Tem certeza que deseja remover "' + nome + '"?')) return;
            
            if (produtos[categoria]) {
                delete produtos[categoria][nome];
                if (Object.keys(produtos[categoria]).length === 0) {
                    delete produtos[categoria];
                }
                
                try {
                    localStorage.setItem('vp', JSON.stringify(produtos));
                } catch (e) {}
                
                renderizarAdmin();
                showToast('üóëÔ∏è Produto removido!');
            }
        }

        function renderizarAdmin() {
            var container = document.getElementById('adminList');
            if (!container) return;
            
            container.innerHTML = '';
            var total = 0;
            
            for (var categoria in produtos) {
                for (var nome in produtos[categoria]) {
                    total++;
                    var dados = produtos[categoria][nome];
                    
                    var div = document.createElement('div');
                    div.className = 'admin-item';
                    div.innerHTML = 
                        '<div class="admin-item-info">' +
                            '<div class="admin-item-name">' + escapeHtml(nome) + '</div>' +
                            '<div class="admin-item-cat">' + categoria + '</div>' +
                        '</div>' +
                        '<div style="display: flex; align-items: center;">' +
                            '<div class="admin-item-hours">' + dados.horas + 'h</div>' +
                            '<button class="btn-icon delete" onclick="removerProduto(\'' + categoria + '\', \'' + escapeHtml(nome) + '\')" title="Remover">' +
                                'üóëÔ∏è' +
                            '</button>' +
                        '</div>';
                    container.appendChild(div);
                }
            }
            
            if (total === 0) {
                container.innerHTML = 
                    '<div class="empty-state">' +
                        '<div class="empty-state-icon">üì¶</div>' +
                        '<div>Nenhum produto cadastrado</div>' +
                    '</div>';
            }
        }
                // ==========================================
        // UTILITARIOS
        // ==========================================
        function showToast(mensagem, erro) {
            var toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = mensagem;
            toast.className = 'toast show' + (erro ? ' error' : '');
            setTimeout(function() {
                toast.classList.remove('show');
            }, 3000);
        }

        // Fecha sugestoes ao clicar fora
        document.addEventListener('click', function(e) {
            var searchPrint = document.getElementById('searchPrint');
            var suggestionsPrint = document.getElementById('suggestionsPrint');
            if (searchPrint && suggestionsPrint && !searchPrint.contains(e.target) && !suggestionsPrint.contains(e.target)) {
                suggestionsPrint.classList.remove('active');
            }
        });

        // Inicia aplicacao
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>        // ==========================================
        // VARIAVEIS DE HORARIO
        // ==========================================
        var horarioBase = null; // null = usar horario atual

        function atualizarHorarioManual() {
            var input = document.getElementById('horarioManual');
            if (input && input.value) {
                horarioBase = new Date(input.value);
                showToast('‚è∞ Hor√°rio definido: ' + horarioBase.toLocaleString('pt-BR'));
                renderizarCategorias();
            }
        }

        function usarHorarioAtual() {
            horarioBase = null;
            var input = document.getElementById('horarioManual');
            if (input) input.value = '';
            showToast('üîÑ Usando hor√°rio atual');
            renderizarCategorias();
        }

        // Sobrescreve calcularValidade para usar horarioBase
        function calcularValidade(horas) {
            var agora = horarioBase || new Date();
            var validade = new Date(agora.getTime() + (horas * 60 * 60 * 1000));
            
            var dias = ['Do', '2¬™', '3¬™', '4¬™', '5¬™', '6¬™', 'S√°'];
            
            return {
                data: ('0' + validade.getDate()).slice(-2) + '/' + ('0' + (validade.getMonth() + 1)).slice(-2),
                hora: ('0' + validade.getHours()).slice(-2) + ':' + ('0' + validade.getMinutes()).slice(-2),
                diaSemana: dias[validade.getDay()]
            };
        }

        // ==========================================
        // SISTEMA DE LOGIN DONO
        // ==========================================
        var donoLogado = false;
        const DONO_USER = '817228';
        const DONO_PASS = '8172';

        function fazerLogin() {
            var user = document.getElementById('loginUser').value;
            var pass = document.getElementById('loginPass').value;
            
            if (user === DONO_USER && pass === DONO_PASS) {
                donoLogado = true;
                document.getElementById('loginPanel').style.display = 'none';
                document.getElementById('painelAdmin').style.display = 'block';
                document.getElementById('loginErro').style.display = 'none';
                donoAtualizarSelect();
                donoRenderizarLista();
                showToast('‚úÖ Bem-vindo, Dono!');
            } else {
                document.getElementById('loginErro').style.display = 'block';
            }
        }

        function donoSair() {
            donoLogado = false;
            document.getElementById('loginUser').value = '';
            document.getElementById('loginPass').value = '';
            document.getElementById('loginPanel').style.display = 'block';
            document.getElementById('painelAdmin').style.display = 'none';
            showView('consulta');
        }

        // ==========================================
        // FUNCOES DO DONO - CRUD COMPLETO
        // ==========================================
        function donoAdicionar() {
            var categoria = document.getElementById('donoCategoria').value;
            var nome = document.getElementById('donoNome').value.trim();
            var horas = parseInt(document.getElementById('donoHoras').value);
            var amb = parseInt(document.getElementById('donoAmb').value) || 0;
            
            if (!nome || !horas) {
                showToast('‚ùå Preencha nome e validade!', true);
                return;
            }
            
            if (!produtos[categoria]) produtos[categoria] = {};
            
            if (produtos[categoria][nome]) {
                showToast('‚ùå Produto j√° existe! Use Modificar.', true);
                return;
            }
            
            produtos[categoria][nome] = { horas: horas, amb: amb };
            salvarDados();
            
            document.getElementById('donoNome').value = '';
            document.getElementById('donoHoras').value = '';
            document.getElementById('donoAmb').value = '';
            
            donoAtualizarSelect();
            donoRenderizarLista();
            renderizarCategorias();
            showToast('‚úÖ Produto adicionado!');
        }

        function donoAtualizarSelect() {
            var select = document.getElementById('donoSelectProduto');
            if (!select) return;
            
            var html = '<option value="">-- Escolha um produto --</option>';
            
            for (var cat in produtos) {
                html += '<optgroup label="' + cat + '">';
                for (var nome in produtos[cat]) {
                    html += '<option value="' + cat + '|' + nome + '">' + nome + ' (' + produtos[cat][nome].horas + 'h)</option>';
                }
                html += '</optgroup>';
            }
            
            select.innerHTML = html;
        }

        var produtoEditando = null;

        function donoCarregarProduto() {
            var select = document.getElementById('donoSelectProduto');
            if (!select || !select.value) {
                produtoEditando = null;
                return;
            }
            
            var parts = select.value.split('|');
            var categoria = parts[0];
            var nome = parts[1];
            
            if (produtos[categoria] && produtos[categoria][nome]) {
                produtoEditando = { categoria: categoria, nome: nome, dados: produtos[categoria][nome] };
                document.getElementById('donoEditHoras').value = produtoEditando.dados.horas;
                document.getElementById('donoEditAmb').value = produtoEditando.dados.amb;
            }
        }

        function donoSalvarEdicao() {
            if (!produtoEditando) {
                showToast('‚ùå Selecione um produto primeiro!', true);
                return;
            }
            
            var novasHoras = parseInt(document.getElementById('donoEditHoras').value);
            var novoAmb = parseInt(document.getElementById('donoEditAmb').value) || 0;
            
            if (!novasHoras) {
                showToast('‚ùå Validade inv√°lida!', true);
                return;
            }
            
            produtos[produtoEditando.categoria][produtoEditando.nome] = { horas: novasHoras, amb: novoAmb };
            salvarDados();
            
            donoAtualizarSelect();
            donoRenderizarLista();
            renderizarCategorias();
            showToast('‚úÖ Produto atualizado!');
        }

        function donoExcluir() {
            if (!produtoEditando) {
                showToast('‚ùå Selecione um produto primeiro!', true);
                return;
            }
            
            if (!confirm('Tem certeza que deseja EXCLUIR "' + produtoEditando.nome + '" permanentemente?')) return;
            
            delete produtos[produtoEditando.categoria][produtoEditando.nome];
            
            if (Object.keys(produtos[produtoEditando.categoria]).length === 0) {
                delete produtos[produtoEditando.categoria];
            }
            
            salvarDados();
            
            document.getElementById('donoSelectProduto').value = '';
            document.getElementById('donoEditHoras').value = '';
            document.getElementById('donoEditAmb').value = '';
            produtoEditando = null;
            
            donoAtualizarSelect();
            donoRenderizarLista();
            renderizarCategorias();
            showToast('üóëÔ∏è Produto exclu√≠do!');
        }

        function donoRenderizarLista() {
            var container = document.getElementById('donoListaProdutos');
            if (!container) return;
            
            var total = 0;
            var html = '';
            
            for (var cat in produtos) {
                for (var nome in produtos[cat]) {
                    total++;
                    var d = produtos[cat][nome];
                    html += '<div class="admin-item">' +
                        '<div class="admin-item-info">' +
                            '<div class="admin-item-name">' + nome + '</div>' +
                            '<div class="admin-item-cat">' + cat + '</div>' +
                        '</div>' +
                        '<div class="admin-item-hours">' + d.horas + 'h' + (d.amb > 0 ? ' (Amb: ' + d.amb + 'h)' : '') + '</div>' +
                    '</div>';
                }
            }
            
            if (total === 0) {
                html = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><div>Nenhum produto</div></div>';
            }
            
            container.innerHTML = html;
        }

        function salvarDados() {
            try {
                localStorage.setItem('vp', JSON.stringify(produtos));
            } catch (e) {
                console.log('Erro ao salvar');
            }
        }

        // Atualiza showView para incluir 'dono'
        var originalShowView = showView;
        showView = function(viewName) {
            if (viewName === 'dono' && !donoLogado) {
                // Reseta tela de login
                document.getElementById('loginPanel').style.display = 'block';
                document.getElementById('painelAdmin').style.display = 'none';
                document.getElementById('loginUser').value = '';
                document.getElementById('loginPass').value = '';
                document.getElementById('loginErro').style.display = 'none';
            }
            
            // Chama fun√ß√£o original
            var views = document.querySelectorAll('.view');
            for (var i = 0; i < views.length; i++) views[i].classList.remove('active');
            var navs = document.querySelectorAll('.nav-item');
            for (var i = 0; i < navs.length; i++) navs[i].classList.remove('active');
            
            var viewId = 'view' + viewName.charAt(0).toUpperCase() + viewName.slice(1);
            var view = document.getElementById(viewId);
            if (view) view.classList.add('active');
            
            var buttons = document.querySelectorAll('.nav-item');
            if (viewName === 'consulta' && buttons[0]) buttons[0].classList.add('active');
            if (viewName === 'impressao' && buttons[1]) buttons[1].classList.add('active');
            if (viewName === 'admin' && buttons[2]) buttons[2].classList.add('active');
            if (viewName === 'dono' && buttons[3]) buttons[3].classList.add('active');
            
            if (viewName === 'consulta') renderizarCategorias();
            if (viewName === 'admin') renderizarAdmin();
            if (viewName === 'impressao') renderizarHistorico();
        };
        
</body>
</html>
